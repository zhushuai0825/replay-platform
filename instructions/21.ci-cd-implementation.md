# 21. CI/CD 实施计划

> 当前仓库尚未落地 CI/CD，这里给出从“无”到“可用”的实施方案。后续每完成一步，都请在此文档中记录。

---

## 1. 目标

- **持续集成**：每次推送/PR 执行基础检查（Lint、Test、Build）
- **持续交付**：构建 Docker 镜像并推送仓库，为部署提供稳定产物
- **持续部署（可选）**：通过 ArgoCD/Flux 等自动发布到测试/生产环境

---

## 2. 基础步骤

1. **准备鉴权**  
   - 创建容器镜像仓库（Docker Hub、Harbor、ACR 等）  
   - 获取用户名/Token，作为 CI 密钥（GitHub Secrets）
2. **GitHub Actions Workflow**  
   - 文件：`.github/workflows/ci.yml`
   - Job 设计：
     - `backend`: 安装 Python、执行 `pip install -r requirements-dev.txt`、运行 `pytest`
     - `frontend`: 安装 Node、执行 `npm install`、`npm run build`
     - `docker-build`: 构建 `backend/Dockerfile` 与 `frontend/Dockerfile`，推送到镜像仓库
3. **缓存与优化**  
   - 使用 `actions/cache` 缓存 pip/npm 依赖  
   - 构建镜像时利用多阶段 Dockerfile 减少体积

---

## 3. 持续交付扩展

- 在 CI 中生成构建产物（前端 `dist/`、后端镜像 Tag）  
- 将版本信息写入 `docs/release-notes.md` 或 GitHub Release  
- 可添加 “手动发布” Job，通过 workflow_dispatch 触发

---

## 4. 持续部署（可选）

1. **GitOps 流程**  
   - 建立部署仓库（保存 Helm values/Kustomize overlays）
   - CI 将镜像 Tag 写入部署仓库的 YAML
2. **ArgoCD/Flux**  
   - 监控部署仓库，一旦有新 Tag 自动同步到集群  
   - 配置回滚策略（保留上一版本 values）

---

## 5. 待办列表

- [ ] 为后端/前端补充最小测试（参考文档 #9）  
- [ ] 在仓库根目录创建 `.github/workflows/ci.yml`  
- [ ] 配置镜像仓库，并在 Secrets 中添加 `REGISTRY_USER/REGISTRY_TOKEN`  
- [ ] 构建成功后推送镜像，输出 Tag 供部署使用  
- [ ] 记录 CI 状态徽章（README）

当以上步骤逐一落地后，再回到此文档，将“计划”替换为实际命令和配置。

