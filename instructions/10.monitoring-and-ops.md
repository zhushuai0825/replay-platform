# 10. 监控与运维建议

1. **日志**
   - 后端：结构化日志（JSON），输出到 stdout + 文件
   - 前端：Nginx 日志或 Sentry 前端埋点
   - 集成 Loki + Promtail 收集容器日志
2. **监控指标**
   - 后端：集成 Prometheus FastAPI 中间件（如 prometheus-fastapi-instrumentator）
     - 导出：请求量、响应时间、任务数
   - 系统：Docker stats、Node Exporter
3. **可视化**
   - 使用 Grafana 导入 Dashboard（任务执行成功率、平均耗时、Celery Worker 状态）
4. **告警**
   - Prometheus Alertmanager：任务失败率高、队列积压、服务宕机
   - 接入钉钉/企业微信/Slack 等通道
5. **备份与恢复**
   - 数据库：定期 `pg_dump` 或使用 WAL 备份
   - 流量文件：同步到对象存储（MinIO/S3），开启版本控制
6. **部署**
   - 初期可用 docker compose；后期可迁移到 K8s（Helm Charts + StatefulSet）
   - 配置环境变量与密钥管理（Vault、Parameter Store）
7. **故障排查**
   - 先看日志，再查指标
   - 差异定位：重现请求、比对环境变量、校验数据一致性
