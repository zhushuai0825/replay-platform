# 16. API 文档与调试工具（详细指南）

## 1. 自动文档（FastAPI）
- 在路由中使用 `tags`、`summary`、`description`、`response_model`：
  ```python
  @router.get("/", response_model=TaskListResponse, tags=["tasks"], summary="任务列表")
  async def list_tasks(...):
      ...
  ```
- 文档地址：
  - Swagger UI: `/docs`
  - ReDoc: `/redoc`
- 可自定义 OpenAPI 元数据（`FastAPI(..., title, description, version)`）。

## 2. 手工文档
- 在 `docs/api.md` 中记录关键接口：
  ```
  ## GET /api/v1/tasks/
  - 描述：分页获取任务列表
  - 参数：page、page_size、status、search
  - 返回示例：
    {
      "items": [...],
      "total": 100
    }
  - 认证：Bearer Token
  ```

## 3. Postman / Thunder Client
- 创建环境变量：
  ```
  base_url = http://localhost:8000
  token = <登录获取的 JWT>
  ```
- 示例请求：
  - 任务列表：GET `{{base_url}}/api/v1/tasks/?page=1&page_size=10`
  - 创建任务：POST `{{base_url}}/api/v1/tasks/`
  - 上传流量：POST `{{base_url}}/api/v1/traffic/upload`
- 保存 Collection，方便团队共享。

## 4. Mock & Sandbox
- 早期可使用 Postman mock server 或 json-server 模拟接口：
  ```bash
  npx json-server --watch mock-data.json --port 3001
  ```
- 前端可先对接 mock，再切换到真实后端，减少等待。

## 5. SDK/客户端（可选）
- Python 客户端示例（`clients/python_client.py`）：
  ```python
  import requests

  class ReplayPlatformClient:
      def __init__(self, base_url, token=None):
          self.base_url = base_url
          self.token = token

      def _headers(self):
          headers = {"Content-Type": "application/json"}
          if self.token:
              headers["Authorization"] = f"Bearer {self.token}"
          return headers

      def list_tasks(self, page=1, page_size=10):
          resp = requests.get(
              f"{self.base_url}/api/v1/tasks/",
              params={"page": page, "page_size": page_size},
              headers=self._headers(),
          )
          resp.raise_for_status()
          return resp.json()
  ```
- JS 客户端可复用 axios 实例或打包 npm 包。
