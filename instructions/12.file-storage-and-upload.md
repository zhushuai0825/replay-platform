# 12. 流量文件存储与上传策略

1. 目录结构
   - `backend/data/traffic/`：存储原始流量文件
   - `backend/data/temp/`：临时文件/解压目录
2. 上传接口设计
   - `POST /api/v1/traffic/upload`
   - 使用 `UploadFile` + `await file.read(chunk_size)` 分块写入
   - 超过 `settings.TRAFFIC_FILE_MAX_SIZE` 立即中断并删除临时文件
3. 元数据入库
   - `TrafficFile` 字段：`filename`（唯一名）、`original_filename`、`file_path`、`file_size`、`file_type`、`created_at`
4. 前端上传
   - FormData：`form.append('file', file)`
   - axios：`api.post('/api/v1/traffic/upload', form, { headers: { 'Content-Type': 'multipart/form-data' } })`
5. 存储策略扩展
   - 大文件迁移到对象存储（MinIO/S3），保存 presigned URL
   - 添加清理脚本 `scripts/cleanup_old_files.py`
