# 20. 故障排查清单（步骤化）

## 1. 后端接口报错
- 查看日志：
  ```bash
  docker compose logs backend | tail -n 200
  ```
- 常见问题：
  - 数据库连接失败 → 检查 `DATABASE_URL`、服务是否 healthy
  - 依赖缺失 → 确认 `requirements.txt`、重新构建镜像
  - 未处理异常 → 通过日志定位堆栈，补充异常处理

## 2. Celery 任务不执行
- 查看 worker 日志：`docker compose logs celery-worker`
- 检查 queuing：
  ```bash
  redis-cli -h localhost -p 6379 LLEN celery
  ```
- 确认 `CELERY_BROKER_URL`、`CELERY_RESULT_BACKEND` 与 Redis 是否可达

## 3. 上传文件失败
- 前端 Network 面板查看响应 code/message
- 后端日志：`docker compose logs backend`
- 核对：
  - 文件体积是否超限（`TRAFFIC_FILE_MAX_SIZE`）
  - 磁盘空间：`df -h backend/data`
  - 目录权限：`backend/data/traffic` 是否可写

## 4. 前端空白 / API 404
- 浏览器控制台错误信息
- 确认 `.env` 中 `VITE_API_BASE_URL`
- CORS 报错：检查后端 `allow_origins`
- 路由 404：确保 `app.include_router` 的前缀与前端请求一致

## 5. Docker 启动失败
- `docker compose ps` 查看容器状态（Exited/Restarting）
- 查看具体服务日志：
  ```bash
  docker compose logs -f backend
  docker compose logs -f postgres
  ```
- 常见修复：删除容器重建、检查端口占用、确认 `.env` 配置

## 6. 性能问题
- 数据库慢查询：开启 `log_min_duration_statement`，或使用 pg_stat_statements
- Celery 队列堆积：
  ```bash
  redis-cli LLEN celery
  ```
- Profiling：
  - 后端：PyInstrument、cProfile
  - 前端：Chrome Performance / Lighthouse
# 20. 故障排查清单

1. **后端接口报错**
   - 查看 `backend/logs/app.log` 或 `docker compose logs backend`
   - 确认数据库连接、环境变量、依赖版本
2. **Celery 任务不执行**
   - `docker compose logs celery-worker`
   - 检查 Redis 连通、Broker 配置、任务是否入队
3. **上传文件失败**
   - 检查 Nginx/前端日志、后端体积限制
   - 确认磁盘空间充足
4. **前端空白/接口 404**
   - 浏览器控制台 + Network 面板
   - 确认 `VITE_API_BASE_URL`、CORS、路由配置
5. **Docker 启动失败**
   - `docker compose ps` 查看状态
   - 逐个 `docker compose logs -f service` 排查
6. **性能问题**
   - 检查数据库慢查询、Celery 队列堆积
   - 使用 Profiling/Tracing 工具定位瓶颈
