# 17. 前端状态管理与 UI 规范（详细指南）

## 1. 状态管理（Pinia 示例）

安装：`npm install pinia`

### `src/store/task.js`
```javascript
import { defineStore } from 'pinia'
import api from '@/api'

export const useTaskStore = defineStore('task', {
  state: () => ({
    items: [],
    total: 0,
    page: 1,
    pageSize: 10,
    status: '',
    search: '',
    loading: false,
    currentTask: null,
  }),
  actions: {
    async fetchTasks() {
      this.loading = true
      const params = { page: this.page, page_size: this.pageSize }
      if (this.status) params.status = this.status
      if (this.search) params.search = this.search
      const res = await api.get('/api/v1/tasks/', { params })
      this.items = res.items
      this.total = res.total
      this.loading = false
    },
    async fetchTaskDetail(taskId) {
      this.currentTask = await api.get(`/api/v1/tasks/${taskId}`)
    },
  },
})
```
在 `main.js`：
```javascript
import { createPinia } from 'pinia'
const pinia = createPinia()
app.use(pinia)
```

## 2. UI 规范
- 采用 Element Plus：
  ```bash
  npm install element-plus
  ```
- 在 `main.js` 引入：
  ```javascript
  import ElementPlus from 'element-plus'
  import 'element-plus/dist/index.css'
  app.use(ElementPlus)
  ```
- 布局：左侧菜单（任务/流量/环境），顶部显示用户信息，内容区域滚动。

## 3. 组件划分
- 通用组件：搜索栏（`components/common/SearchBar.vue`）、分页器、信息卡、进度条
- 业务组件：`components/tasks/TaskTable.vue`、`TaskDetailDrawer.vue`

## 4. 表单与校验
- 使用 Element Plus Form + yup：
  ```javascript
  import * as yup from 'yup'
  const schema = yup.object({
    name: yup.string().required(),
    base_url: yup.string().url().required(),
  })
  ```
- 在提交前 `await schema.validate(formData)`，提示用户必填项、URL 格式等。

## 5. 国际化（vue-i18n）
- 安装：`npm install vue-i18n`
- 配置 `src/i18n/index.js` 并在组件中使用 `t('key')` 渲染文案，方便多语言切换。
